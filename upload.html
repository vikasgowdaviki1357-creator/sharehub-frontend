<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload Item | Share Hub</title>
  <link rel="stylesheet" href="./css/style.css">
</head>

<body>

<!-- ================= NAVBAR ================= -->
<header class="navbar">
  <div class="logo">‚ù§ SHARE HUB</div>
  <nav>
    <a href="browse.html">Browse</a>
    <a href="index.html">Home</a>
    <a href="#" class="btn" onclick="logout()">Logout</a>
  </nav>
</header>

<!-- ================= UPLOAD PAGE ================= -->
<section class="upload-bg">
  <div class="upload-overlay"></div>

  <div class="upload-glass">
    <h2>üì¶ Upload Product</h2>
    <p class="upload-subtitle">Share your study materials with juniors</p>

    <form id="uploadForm">

      <input type="text" id="name" placeholder="Product Name" required>

      <input type="text" id="category" placeholder="Category (electronics/ study material)" required>

      <input type="number" id="price" placeholder="Price (‚Çπ)" required>

      <input type="number" id="yearsUsed" placeholder="Used for how many years?" required>

      <input type="tel" id="phone" placeholder="Seller Phone Number" required>

      <input type="text" id="image" placeholder="Image URL (paste link here)" required>

      <button type="submit" class="upload-btn">
        Upload Item üöÄ
      </button>

    </form>
  </div>
</section>

<script src="auth.js"></script>

<script>
const BASE_URL = "https://sharehub-backend-lm98.onrender.com";

document.getElementById("uploadForm").addEventListener("submit", async function (e) {
    e.preventDefault(); // üöÄ VERY IMPORTANT ‚Äì stops refresh

    const currentUser = JSON.parse(localStorage.getItem("currentUser"));
    if (!currentUser) {
        alert("Please login again");
        return;
    }

    const itemData = {
        name: document.getElementById("name").value,
        category: document.getElementById("category").value,
        price: document.getElementById("price").value,
        yearsUsed: document.getElementById("years").value,
        phone: document.getElementById("phone").value,
        image: document.getElementById("image").value, // image URL
        sellerEmail: currentUser.email,
        sold: false
    };

    try {
        const response = await fetch(`${BASE_URL}/api/items/add`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(itemData)
        });

        const data = await response.json();

        alert("Item uploaded successfully!");
        window.location.href = "browse.html";

    } catch (error) {
        console.error(error);
        alert("Upload failed");
    }
});
</script>

</body>
</html>